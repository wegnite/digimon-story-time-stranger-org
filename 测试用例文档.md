# AI Polaroid Photo SaaS 测试用例文档

## 项目概述
AI Polaroid Photo 是一个基于 Next.js 15 的全栈 SaaS 应用，主要功能包括AI图像生成、用户认证、订阅支付、积分系统等。

## 技术栈
- **前端框架**: Next.js 15 + React 19 + TypeScript
- **UI组件**: Radix UI + TailwindCSS + shadcn/ui
- **认证系统**: Better Auth (支持邮箱/密码、Google、GitHub登录)
- **数据库**: PostgreSQL + Drizzle ORM
- **支付系统**: Stripe (订阅 + 一次性支付)
- **AI集成**: 多个AI提供商 (OpenAI, Replicate, DeepSeek 等)
- **国际化**: next-intl (英文/中文)
- **状态管理**: Zustand
- **测试框架**: Vitest

---

## 1. 认证系统测试用例

### 1.1 用户注册功能

#### TC001: 邮箱注册成功
- **前置条件**: 用户未注册
- **测试步骤**:
  1. 访问注册页面 `/sign-up`
  2. 输入有效邮箱地址
  3. 输入符合要求的密码
  4. 点击注册按钮
- **预期结果**: 用户注册成功，收到邮箱验证邮件

#### TC002: 邮箱格式验证
- **测试步骤**:
  1. 输入无效邮箱格式 (test@, @test.com, test)
  2. 尝试注册
- **预期结果**: 显示邮箱格式错误提示

#### TC003: 密码强度验证
- **测试步骤**:
  1. 输入弱密码 (少于8位、无特殊字符等)
  2. 尝试注册
- **预期结果**: 显示密码强度要求提示

#### TC004: 重复邮箱注册
- **测试步骤**:
  1. 使用已注册的邮箱尝试注册
- **预期结果**: 提示邮箱已被使用

### 1.2 用户登录功能

#### TC005: 邮箱密码登录成功
- **前置条件**: 用户已注册并验证邮箱
- **测试步骤**:
  1. 访问登录页面 `/sign-in`
  2. 输入正确的邮箱和密码
  3. 点击登录按钮
- **预期结果**: 登录成功，跳转到dashboard

#### TC006: 错误密码登录
- **测试步骤**:
  1. 输入正确邮箱，错误密码
  2. 尝试登录
- **预期结果**: 显示用户名或密码错误

#### TC007: Google社交登录
- **测试步骤**:
  1. 点击Google登录按钮
  2. 完成Google授权
- **预期结果**: 登录成功或创建新账户

#### TC008: GitHub社交登录
- **测试步骤**:
  1. 点击GitHub登录按钮
  2. 完成GitHub授权
- **预期结果**: 登录成功或创建新账户

### 1.3 邮箱验证功能

#### TC009: 邮箱验证成功
- **测试步骤**:
  1. 注册新用户
  2. 点击邮件中的验证链接
- **预期结果**: 邮箱验证成功，可以正常登录

#### TC010: 验证链接过期
- **测试步骤**:
  1. 使用过期的验证链接
- **预期结果**: 提示链接已过期

### 1.4 密码重置功能

#### TC011: 密码重置流程
- **测试步骤**:
  1. 访问忘记密码页面
  2. 输入注册邮箱
  3. 点击发送重置邮件
  4. 点击邮件中的重置链接
  5. 设置新密码
- **预期结果**: 密码重置成功，可用新密码登录

---

## 2. 支付系统测试用例

### 2.1 订阅支付功能

#### TC012: Pro月订阅支付
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 访问定价页面
  2. 选择Pro月订阅计划
  3. 点击订阅按钮
  4. 在Stripe页面完成支付
- **预期结果**: 支付成功，用户获得Pro权限

#### TC013: Pro年订阅支付
- **测试步骤**:
  1. 选择Pro年订阅计划
  2. 完成Stripe支付流程
- **预期结果**: 支付成功，用户获得Pro年度权限

#### TC014: 终身版支付
- **测试步骤**:
  1. 选择终身版计划
  2. 完成一次性支付
- **预期结果**: 支付成功，用户获得终身权限

#### TC015: 支付失败处理
- **测试步骤**:
  1. 使用无效信用卡信息尝试支付
- **预期结果**: 显示支付失败错误信息

### 2.2 订阅管理功能

#### TC016: 订阅状态查看
- **前置条件**: 用户有活跃订阅
- **测试步骤**:
  1. 访问用户dashboard
  2. 查看订阅状态区域
- **预期结果**: 正确显示当前订阅计划和状态

#### TC017: 取消订阅
- **测试步骤**:
  1. 访问Stripe客户门户
  2. 取消当前订阅
- **预期结果**: 订阅在周期结束后取消

#### TC018: 升级订阅
- **测试步骤**:
  1. 从月订阅升级到年订阅
- **预期结果**: 订阅成功升级，费用按比例计算

### 2.3 积分系统测试

#### TC019: 积分包购买
- **测试步骤**:
  1. 访问积分购买页面
  2. 选择积分包
  3. 完成支付
- **预期结果**: 积分成功添加到用户账户

#### TC020: 积分消耗
- **测试步骤**:
  1. 使用AI功能生成图片
  2. 检查积分余额变化
- **预期结果**: 积分按使用量正确扣除

#### TC021: 积分余额不足
- **测试步骤**:
  1. 在积分余额不足时尝试使用付费功能
- **预期结果**: 提示积分不足，引导购买

---

## 3. AI功能测试用例

### 3.1 图像生成功能

#### TC022: 基础图像生成
- **前置条件**: 用户有足够积分或订阅权限
- **测试步骤**:
  1. 访问AI图像生成页面
  2. 输入文本提示词
  3. 选择图像风格/模型
  4. 点击生成按钮
- **预期结果**: 成功生成图像并显示

#### TC023: 不同AI提供商测试
- **测试步骤**:
  1. 分别测试OpenAI、Replicate、DeepSeek等提供商
  2. 使用相同提示词生成图像
- **预期结果**: 所有提供商都能正常工作

#### TC024: 图像参数设置
- **测试步骤**:
  1. 调整图像尺寸、质量等参数
  2. 生成图像
- **预期结果**: 生成的图像符合设置参数

#### TC025: 批量图像生成
- **测试步骤**:
  1. 设置生成多张图像
  2. 提交生成请求
- **预期结果**: 成功生成指定数量的图像

### 3.2 Polaroid编辑器功能

#### TC026: Polaroid模板应用
- **测试步骤**:
  1. 上传或生成图像
  2. 应用Polaroid模板
  3. 调整模板参数
- **预期结果**: 图像成功应用Polaroid效果

#### TC027: 图像编辑工具
- **测试步骤**:
  1. 使用画布编辑工具
  2. 添加文字、调整颜色等
- **预期结果**: 编辑功能正常工作

#### TC028: 图像导出功能
- **测试步骤**:
  1. 完成图像编辑
  2. 导出为不同格式 (PNG, JPG)
- **预期结果**: 成功导出编辑后的图像

### 3.3 AI聊天功能

#### TC029: 基础对话测试
- **测试步骤**:
  1. 访问AI聊天页面
  2. 发送测试消息
- **预期结果**: AI正确响应用户消息

#### TC030: 上下文理解测试
- **测试步骤**:
  1. 进行多轮对话
  2. 检查AI是否理解上下文
- **预期结果**: AI能理解并保持对话上下文

---

## 4. 用户管理测试用例

### 4.1 用户资料管理

#### TC031: 更新用户资料
- **测试步骤**:
  1. 访问用户设置页面
  2. 更新姓名、头像等信息
  3. 保存更改
- **预期结果**: 用户资料成功更新

#### TC032: 更改邮箱
- **测试步骤**:
  1. 在设置中更改邮箱
  2. 验证新邮箱
- **预期结果**: 邮箱更改成功

#### TC033: 更改密码
- **测试步骤**:
  1. 在设置中更改密码
  2. 输入当前密码和新密码
- **预期结果**: 密码更改成功

### 4.2 用户状态管理

#### TC034: 用户封禁功能（管理员）
- **前置条件**: 管理员权限
- **测试步骤**:
  1. 访问用户管理页面
  2. 封禁指定用户
- **预期结果**: 用户被封禁，无法登录

#### TC035: 用户解封功能（管理员）
- **测试步骤**:
  1. 解封被封禁的用户
- **预期结果**: 用户恢复正常使用权限

---

## 5. 国际化测试用例

### 5.1 语言切换功能

#### TC036: 英文切换到中文
- **测试步骤**:
  1. 在英文界面点击语言切换器
  2. 选择中文
- **预期结果**: 界面语言切换为中文

#### TC037: 中文切换到英文
- **测试步骤**:
  1. 在中文界面切换到英文
- **预期结果**: 界面语言切换为英文

#### TC038: URL路由国际化
- **测试步骤**:
  1. 访问 `/en/dashboard` 和 `/zh/dashboard`
- **预期结果**: 显示对应语言的页面内容

### 5.2 内容本地化

#### TC039: 错误消息本地化
- **测试步骤**:
  1. 在不同语言下触发错误消息
- **预期结果**: 错误消息显示对应语言

#### TC040: 日期格式本地化
- **测试步骤**:
  1. 检查不同语言下的日期显示
- **预期结果**: 日期格式符合当地习惯

---

## 6. 性能测试用例

### 6.1 页面加载性能

#### TC041: 首页加载时间
- **测试步骤**:
  1. 清除浏览器缓存
  2. 访问首页
  3. 测量加载时间
- **预期结果**: 页面在3秒内完成加载

#### TC042: 图像生成响应时间
- **测试步骤**:
  1. 提交图像生成请求
  2. 测量响应时间
- **预期结果**: 在合理时间内返回结果

### 6.2 并发性能测试

#### TC043: 多用户同时生成图像
- **测试步骤**:
  1. 模拟多个用户同时请求图像生成
- **预期结果**: 系统正常处理所有请求

---

## 7. 安全测试用例

### 7.1 认证安全

#### TC044: SQL注入防护
- **测试步骤**:
  1. 在登录表单中输入SQL注入攻击代码
- **预期结果**: 系统正确过滤，不受影响

#### TC045: XSS防护
- **测试步骤**:
  1. 在用户输入字段中输入恶意脚本
- **预期结果**: 脚本被正确转义，不执行

#### TC046: CSRF防护
- **测试步骤**:
  1. 尝试跨站请求伪造攻击
- **预期结果**: 请求被正确拒绝

### 7.2 数据安全

#### TC047: 敏感信息加密
- **测试步骤**:
  1. 检查数据库中的密码存储
- **预期结果**: 密码已正确加密

#### TC048: API访问控制
- **测试步骤**:
  1. 未登录状态访问受保护的API
- **预期结果**: 返回401未授权错误

---

## 8. 兼容性测试用例

### 8.1 浏览器兼容性

#### TC049: Chrome浏览器测试
- **测试步骤**: 在Chrome最新版本中测试所有功能
- **预期结果**: 所有功能正常工作

#### TC050: Firefox浏览器测试
- **测试步骤**: 在Firefox最新版本中测试
- **预期结果**: 所有功能正常工作

#### TC051: Safari浏览器测试
- **测试步骤**: 在Safari中测试
- **预期结果**: 所有功能正常工作

### 8.2 设备兼容性

#### TC052: 移动设备响应式设计
- **测试步骤**:
  1. 在不同尺寸的移动设备上访问网站
- **预期结果**: 界面正确适配移动设备

#### TC053: 平板设备测试
- **测试步骤**:
  1. 在平板设备上测试功能
- **预期结果**: 界面和功能正常工作

---

## 9. 集成测试用例

### 9.1 第三方服务集成

#### TC054: Stripe支付集成
- **测试步骤**:
  1. 测试完整的支付流程
  2. 验证webhook处理
- **预期结果**: 支付状态正确同步

#### TC055: AI服务提供商集成
- **测试步骤**:
  1. 测试各AI提供商的API调用
- **预期结果**: 所有提供商正常响应

#### TC056: 邮件服务集成
- **测试步骤**:
  1. 测试各种邮件发送场景
- **预期结果**: 邮件正常发送和接收

### 9.2 数据库集成

#### TC057: 数据一致性测试
- **测试步骤**:
  1. 执行涉及多表的事务操作
- **预期结果**: 数据保持一致性

---

## 10. 业务流程测试用例

### 10.1 用户完整使用流程

#### TC058: 新用户完整体验流程
- **测试步骤**:
  1. 用户注册
  2. 邮箱验证
  3. 首次登录
  4. 浏览功能
  5. 购买订阅/积分
  6. 使用AI功能
  7. 管理账户
- **预期结果**: 整个流程顺畅完成

#### TC059: 订阅用户续费流程
- **测试步骤**:
  1. 订阅到期前的提醒
  2. 自动续费处理
  3. 续费失败处理
- **预期结果**: 续费流程正确执行

---

## 测试环境配置

### 开发环境
- **URL**: http://localhost:3000
- **数据库**: 开发用PostgreSQL实例
- **AI服务**: 测试API密钥

### 测试环境
- **URL**: https://test.aipolariodphoto.com
- **数据库**: 测试用PostgreSQL实例
- **支付**: Stripe测试模式

### 生产环境
- **URL**: https://aipolariodphoto.com
- **数据库**: 生产PostgreSQL实例
- **支付**: Stripe生产模式

## 测试工具和框架

- **单元测试**: Vitest
- **E2E测试**: Playwright (可选)
- **API测试**: Postman/Insomnia
- **性能测试**: Lighthouse
- **安全测试**: OWASP ZAP

## 测试执行计划

### 冒烟测试（每日）
- 基础登录功能
- 主要AI功能
- 支付基础流程

### 回归测试（每周）
- 完整功能测试
- 兼容性测试
- 性能基准测试

### 完整测试（发布前）
- 所有测试用例
- 安全测试
- 压力测试
- 用户验收测试

## 缺陷管理

### 缺陷等级定义
- **P0 - 阻塞**: 系统无法使用，影响核心功能
- **P1 - 严重**: 主要功能异常，有替代方案
- **P2 - 一般**: 次要功能问题，不影响主流程
- **P3 - 轻微**: 界面显示问题，优化建议

### 缺陷跟踪流程
1. 发现缺陷 → 创建缺陷报告
2. 分配给开发人员 → 修复
3. 测试验证 → 关闭缺陷

## 测试报告

每轮测试完成后，需要提供包含以下内容的测试报告：
- 测试执行概况
- 通过/失败用例统计
- 发现的缺陷汇总
- 风险评估
- 发布建议